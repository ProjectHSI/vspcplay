# This starter workflow is for a CMake project running on multiple platforms. There is a different starter workflow if you just want a single platform.
# See: https://github.com/actions/starter-workflows/blob/main/ci/cmake-single-platform.yml
name: MXE Makefile

on:
  - push
  - workflow_dispatch
    

jobs:
  build:
    runs-on: "ubuntu-latest"

    strategy:
      # Set fail-fast to false to ensure that feedback is delivered for all matrix combinations. Consider changing this to true when your workflow is stable.
      fail-fast: false

    steps:
      - uses: actions/checkout@v4
        name: Checkout
        with:
          submodules: recursive

      - uses: actions/checkout@v4
        name: Checkout MXE
        with:
          repository: 'mxe/mxe'
          ref: 'build-2022-04-09'
          path: 'mxe'
          submodules: recursive

      - name: Build & Install MXE
        run: |
          cd mxe
          mkdir build
          make cc sdl2
          cd ..

      - name: Build
        run: make MXEBASE="mxe" -f Makefile.mxe

      - name: Get Commit Hash
        id: gitcommithash
        shell: bash
        run: |
          echo "git-commit-hash=$(git rev-parse --short HEAD)" >> "$GITHUB_OUTPUT"

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4.0.0
        with:
          name: mxe-${{ steps.gitcommithash.outputs.git-commit-hash }}
          path: |
              vspcplay.exe
          if-no-files-found: error
          retention-days: 0
